# Ocean Race data visualization 2017-2018
## Overview

The Ocean Race is often described as the longest and toughest professional sporting event in the world, sailing’s toughest team challenge and one of the sport’s Big Three events, alongside the Olympic Games and America’s Cup.

The Race starts on 22 October 2017 from Alicante and finished eight months later in The Hague.

At 45,000nm, this will be the longest course in the history of the race (previous longest racecourse was 39,270 in 2011-12.).

It crosses four oceans and take in 12 major cities: Alicante, Lisbon, Cape Town, Melbourne, Hong Kong, Guangzhou, Auckland, Itajaí, Newport RI, Cardiff, Gothenburg and The Hague.

> Volvo Ocean Race Science Programme was funded by Volvo Cars, who have donated €100 from first 3,000 sales of the new Volvo V90 Cross Country Volvo Ocean Race edition to support the initiative. 

## Data collected during the race (3 data sets)

The microplastic particle information was collected from seawater samples taken during the Volvo Ocean Race, which, for the first time, combined a global sporting event with cutting-edge scientific research.
The science initiative, part of the race’s Sustainability Programme, was presented at the MICRO2018 conference, which heard about leading research related to microplastic pollution.

The oceanographic data were collected onboard "Turn the Tide on Plastic" and team "AkzoNobel". 
The meteorological data were collected by Dongfeng Race Team, Team Brunel, Vestas 11th Hour Racing, Sun Hung Kai Scallywag, Turn the Tide on Plastic, Mapfre and Team AkzoNobel.

## Ingestion and enrichment with Spark

The oceanrace_ingestion.py loads the data from an S3 storage bucket, and enriches the tables with additional latitude and longitude values rounded to 1 decimal and to integer in additional columns to provide usable format for visualization. 

| decimal places | degrees  | distance  | 
|---|---|---|
| 0  | 1  |  111  km |
|  1 | 0.1  | 11.1 km  |
|  2 |  0.11 |  1.11 km |
|  3 |  0.111 |  111  m |
|  4 |  0.1111 | 11.1 m  |
|  5 |  0.11111 | 1.11 m  |

The distance of the race is 60.000km, integer and 1 decimal place coordinates would give us appropriate high-level view, but in some places the rounded coordinates have been placed to land near the shore. 

Also the latitude and longitude values been out-of-range for the visualization, therefore the script filters these values as well. 

In the official microparticle csv, the latitude and longitude coordinates have been swapped, this was manually corrected.  

Meteorological data has not been uploaded to github because of it's size. It has to be downloaded directly from the link at the bottom. The oceanrace.py has to be set to the folder, and will ingest all the csv within the folder. 

## Important

the dataviz json has been preset with a username "tsimon", therefore it has to be replaced with the exact username set in oceanrace_ingestion.py
add mapbox token

## Output of spark job

	total number of records in meteorological data files 6688096
	total number of records in microplastic data 358199
	total number of records in OceanographicSurfaceUnderwayData 16035
  
  Filtering: 
  removed records from meteorological data 10280
	removed records from microplastic data after filtering 4889
	removed records from OceanographicSurfaceUnderwayData after filtering 0

+-----+---+------------+------------+-------------------+-------+-------+---------+-----+----+-------+-----+-----+------+------+
|  TWS|TWD|         LAT|        LONG|          TIMESTAMP|AIRTEMP|SEATEMP|BAROPRESS|  COG| SOG|HEADING|r_lat|r_lon|1r_lat|1r_lon|
+-----+---+------------+------------+-------------------+-------+-------+---------+-----+----+-------+-----+-----+------+------+
| 20.5|357|38.687191667|-9.234055556|2017-11-05 14:00:00|     19|     19|   1025.1| 65.0|11.0|     58| 39.0| -9.0|  38.7|  -9.2|
|19.75|352|38.687441667|-9.233480556|2017-11-05 14:00:10|     19|     19|   1025.3| 59.0|11.4|     48| 39.0| -9.0|  38.7|  -9.2|
|18.75|359|38.687758333|-9.233097222|2017-11-05 14:00:20|     19|     19|   1025.3| 55.0| 9.6|     30| 39.0| -9.0|  38.7|  -9.2|
|17.25|  3|38.687922222|-9.233183333|2017-11-05 14:00:30|     19|     19|   1025.4|339.0| 3.5|    326| 39.0| -9.0|  38.7|  -9.2|
| 15.0| 14|38.688169444|-9.233347222|2017-11-05 14:00:40|     19|     19|   1025.3|334.0| 8.0|    327| 39.0| -9.0|  38.7|  -9.2|
| 16.5| 11|38.688463889|-9.232961111|2017-11-05 14:00:50|     19|     19|   1025.4| 54.0| 8.4|     37| 39.0| -9.0|  38.7|  -9.2|
|15.75| 11|   38.688525|-9.232283333|2017-11-05 14:01:00|     19|     19|   1025.1| 78.0|14.0|     76| 39.0| -9.0|  38.7|  -9.2|
|17.25| 21|   38.688525|-9.231433333|2017-11-05 14:01:10|     18|     19|   1025.3| 90.0|14.0|     90| 39.0| -9.0|  38.7|  -9.2|
| 17.5| 25|   38.688525|-9.230605556|2017-11-05 14:01:20|     19|     19|   1025.4| 91.0|14.6|     89| 39.0| -9.0|  38.7|  -9.2|
| 18.0| 20|38.688580556|   -9.229675|2017-11-05 14:01:30|     18|     19|   1025.3| 86.0|15.9|     85| 39.0| -9.0|  38.7|  -9.2|
| 17.5| 22|38.688633333|-9.228736111|2017-11-05 14:01:40|     18|     19|   1025.3| 87.0|15.6|     84| 39.0| -9.0|  38.7|  -9.2|
| 21.0| 24|38.688711111|-9.227858333|2017-11-05 14:01:50|     18|     19|   1025.3| 85.0|14.4|     80| 39.0| -9.0|  38.7|  -9.2|
|22.75| 18|38.688838889|-9.226977778|2017-11-05 14:02:00|     18|     19|   1025.3| 68.0|14.3|     71| 39.0| -9.0|  38.7|  -9.2|
| 20.0| 14|38.688877778|-9.226102778|2017-11-05 14:02:10|     18|     19|   1025.3| 86.0|15.6|     83| 39.0| -9.0|  38.7|  -9.2|
| 18.5| 10|38.688966667|-9.225177778|2017-11-05 14:02:20|     18|     19|   1025.4| 84.0|15.1|     82| 39.0| -9.0|  38.7|  -9.2|
| 16.0| 10|38.689005556|-9.224286111|2017-11-05 14:02:30|     18|     19|   1025.4| 86.0|15.4|     85| 39.0| -9.0|  38.7|  -9.2|
| 12.5|  8|38.689058333|-9.223388889|2017-11-05 14:02:40|     18|     19|   1025.4| 88.0|14.9|     86| 39.0| -9.0|  38.7|  -9.2|
| 13.5| 19|38.689144444|   -9.222575|2017-11-05 14:02:50|     18|     19|   1025.5| 85.0|12.8|     80| 39.0| -9.0|  38.7|  -9.2|
|10.25| 11|     38.6892|-9.221822222|2017-11-05 14:03:00|     18|     19|   1025.4| 85.0|12.7|     83| 39.0| -9.0|  38.7|  -9.2|
| 7.75|  7|38.689216667|-9.221083333|2017-11-05 14:03:10|     18|     19|   1025.4| 94.0|12.9|     87| 39.0| -9.0|  38.7|  -9.2|
+-----+---+------------+------------+-------------------+-------+-------+---------+-----+----+-------+-----+-----+------+------+

+------------------+------------------+-------+-----+-----+------+------+
|         Longitude|          Latitude|MP_conc|r_lat|r_lon|1r_lat|1r_lon|
+------------------+------------------+-------+-----+-----+------+------+
|-9.228458205128204| 38.69541628205128|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.228065256410256| 38.69541525641026|    180| 39.0| -9.0|  38.7|  -9.2|
| -9.22726564102564| 38.69539871794871|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.226349871794874| 38.69480256410256|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.225617435897435| 38.69391282051282|    180| 39.0| -9.0|  38.7|  -9.2|
| -9.22523423076923| 38.69273525641025|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.225651153846155| 38.69160141025641|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.226446666666668|38.690471410256414|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.227573846153847|38.689177564102565|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.229324102564101| 38.68839551282051|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.231339487179488|38.688137179487185|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.233427307692306| 38.68803871794872|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.235547435897436|38.688002051282055|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.237664487179487|38.687912948717944|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.239789615384616| 38.68787538461539|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.241963846153846| 38.68774038461539|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.244099102564103| 38.68746294871796|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.246226538461539|38.687124743589735|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.248333205128205| 38.68664525641026|    180| 39.0| -9.0|  38.7|  -9.2|
|-9.250567692307694|38.686258205128205|    180| 39.0| -9.0|  38.7|  -9.3|
+------------------+------------------+-------+-----+-----+------+------+


+----------------+-----------------+----------------+----------------+----------------+-------------------+----+-----+---+----+------+-----+-----+------+------+
|        Latitude|        Longitude|        pCO2_ppm|temperature_degC|    salinity_PSU|Chlorophyll_mgPerm3|year|month|day|hour|minute|r_lat|r_lon|1r_lat|1r_lon|
+----------------+-----------------+----------------+----------------+----------------+-------------------+----+-----+---+----+------+-----+-----+------+------+
|       36.536495|-1.30071666666667|             NaN|         25.8735|          36.978|            0.86194|2017|   10| 22|  20|    24| 37.0| -1.0|  36.5|  -1.3|
|36.5351828205128|-1.30164076923077|             NaN|25.1313846153846|37.1252307692308|  0.848692307692308|2017|   10| 22|  20|    25| 37.0| -1.0|  36.5|  -1.3|
|36.5327685897436|-1.30338884615385|             NaN|22.8262307692308|37.1318461538462|  0.865166153846154|2017|   10| 22|  20|    26| 37.0| -1.0|  36.5|  -1.3|
|36.4512596153846|-1.34740269230769| 392.40534921897|21.8394615384615|36.5853076923077|  0.861833846153846|2017|   10| 22|  21|     1| 36.0| -1.0|  36.5|  -1.3|
|       36.445945|-1.34871641025641|392.246482364325|21.8296153846154|          36.579|  0.854603076923077|2017|   10| 22|  21|     3| 36.0| -1.0|  36.4|  -1.3|
|36.4433267948718|-1.34890666666667|392.180085952072|21.8398461538462|36.5798461538462|  0.842646153846154|2017|   10| 22|  21|     4| 36.0| -1.0|  36.4|  -1.3|
|36.4410266666667|-1.34894074074074|392.096257310515|21.8536666666667|36.5818888888889|  0.844773333333333|2017|   10| 22|  21|     5| 36.0| -1.0|  36.4|  -1.3|
|35.9926854166667|-4.64469347222222|             NaN|26.2216666666667|36.5934166666667|            0.92335|2017|   10| 23|  13|    48| 36.0| -5.0|  36.0|  -4.6|
| 35.995288974359|-4.64939346153846|             NaN|23.3172307692308|          36.911|  0.933495384615385|2017|   10| 23|  13|    49| 36.0| -5.0|  36.0|  -4.6|
|35.9979298717949|-4.65420487179487|             NaN|22.0138461538462|          36.898|  0.950649230769231|2017|   10| 23|  13|    50| 36.0| -5.0|  36.0|  -4.7|
|36.0005767948718|-4.65941064102564|             NaN|21.8186153846154|36.5796153846154|  0.932683076923077|2017|   10| 23|  13|    51| 36.0| -5.0|  36.0|  -4.7|
|36.0031419230769|-4.66463358974359|             NaN|          21.802|36.5173076923077|  0.915956923076923|2017|   10| 23|  13|    52| 36.0| -5.0|  36.0|  -4.7|
|36.0056788461538|-4.66938346153846|             NaN|21.7914615384615|36.4974615384615|            0.92348|2017|   10| 23|  13|    53| 36.0| -5.0|  36.0|  -4.7|
|36.0082414102564|-4.67428128205128|             NaN|21.7743846153846|36.4841538461539|            0.94668|2017|   10| 23|  13|    54| 36.0| -5.0|  36.0|  -4.7|
|36.0921023076923|-4.85239833333333|388.119459163972|20.8587692307692|36.4257692307692|   1.56197538461538|2017|   10| 23|  14|    30| 36.0| -5.0|  36.1|  -4.9|
|36.0941445833333|-4.85612270833333|388.099398561955|       20.870875|         36.4105|           1.584635|2017|   10| 23|  14|    31| 36.0| -5.0|  36.1|  -4.9|
|       36.456115|-9.45523291666667|             NaN|23.9734166666667|36.5866666666667|            1.28352|2017|   10| 24|   7|    22| 36.0| -9.0|  36.5|  -9.5|
|36.4591203846154|-9.45995012820513|             NaN|21.7483846153846|           36.74|  0.963089230769231|2017|   10| 24|   7|    23| 36.0| -9.0|  36.5|  -9.5|
| 36.462001025641|-9.46473782051282|             NaN|20.9715384615385|36.5640769230769|  0.888193846153846|2017|   10| 24|   7|    24| 36.0| -9.0|  36.5|  -9.5|
|36.4648152564103|-9.46976307692307|             NaN|20.8270769230769|36.4284615384615|  0.886652307692308|2017|   10| 24|   7|    25| 36.0| -9.0|  36.5|  -9.5|
+----------------+-----------------+----------------+----------------+----------------+-------------------+----+-----+---+----+------+-----+-----+------+------+





## Links
Expert conference link: https://archive.theoceanrace.com/en/news/12202_Race-data-revealed-at-expert-conference.html 

Science report: https://drive.google.com/file/d/1y0sJEghnWx_Txn7Zy4l33WZsl_3Zddwq/view 

Download open-access data: https://www.ncei.noaa.gov/access/metadata/landing-page/bin/iso?id=gov.noaa.nodc:0170967 
